<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>H√¥tel | Dashboard Excellence</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Playfair+Display:ital,wght@0,700;1,700&display=swap"
        rel="stylesheet" />
    <style>
        :root {
            --primary: #0052a5;
            --primary-dark: #003770;
            --secondary: #d4af37;
            --bg-sidebar: #0e1a2f;
            --bg-main: #f4f7fa;
            --glass: rgba(255, 255, 255, 0.95);
            --shadow: 0 4px 20px rgba(0, 52, 165, 0.08);
            --text-main: #334155;
            --text-light: #64748b;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-main);
            color: var(--text-main);
            display: flex;
            min-height: 100vh;
        }

        /* === SIDEBAR === */
        .sidebar {
            width: 280px;
            background: var(--bg-sidebar);
            color: white;
            padding: 40px 20px;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
        }

        .sidebar-logo {
            font-family: 'Playfair Display', serif;
            font-size: 26px;
            color: var(--secondary);
            text-align: center;
            margin-bottom: 50px;
        }

        .nav-menu {
            list-style: none;
        }

        .nav-item {
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 12px;
            color: #94a3b8;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-item:hover,
        .nav-item.active {
            background: rgba(212, 175, 55, 0.1);
            color: var(--secondary);
        }

        .nav-item.active {
            background: var(--secondary);
            color: white;
        }

        /* === MAIN CONTENT === */
        .main-content {
            margin-left: 280px;
            flex-grow: 1;
            padding: 40px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .header-top h1 {
            font-family: 'Playfair Display', serif;
            font-size: 32px;
            color: var(--primary);
        }

        /* === STATS WIDGETS === */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0, 0, 0, 0.02);
        }

        .stat-label {
            font-size: 13px;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-increase {
            color: #22c55e;
            font-size: 12px;
            font-weight: 600;
            margin-top: 5px;
        }

        /* === PANELS GRID === */
        .panels-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .panel {
            background: white;
            border-radius: 24px;
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: 600px;
        }

        .panel-header {
            padding: 20px 30px;
            background: white;
            border-bottom: 1px solid #f1f5f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-family: 'Playfair Display', serif;
            font-size: 18px;
            color: var(--primary);
        }

        .panel-content {
            padding: 20px 30px;
            overflow-y: auto;
            flex-grow: 1;
        }

        /* === CARDS === */
        .card {
            background: #fafcfe;
            border: 1px solid #f1f5f9;
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: var(--secondary);
            transform: translateX(5px);
        }

        .card-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .card-tag {
            font-size: 11px;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 10px;
            text-transform: uppercase;
        }

        .status-confirmed,
        .status-deposit_paid {
            background: #dcfce7;
            color: #166534;
        }

        .status-pending {
            background: #fef9c3;
            color: #854d0e;
        }

        .status-cancelled {
            background: #fee2e2;
            color: #991b1b;
        }

        .guest-name {
            font-size: 16px;
            font-weight: 600;
            color: var(--primary);
        }

        .guest-contact {
            font-size: 13px;
            color: #64748b;
            margin: 4px 0;
        }

        .stay-details {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-main);
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* === INTERACTIONS === */
        .interaction-item {
            display: flex;
            gap: 15px;
            padding: 15px 0;
            border-bottom: 1px solid #f1f5f9;
        }

        .intent-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #eff6ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .int-content {
            flex: 1;
        }

        .int-q {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .int-a {
            font-size: 13px;
            color: #64748b;
            line-height: 1.5;
        }

        .int-time {
            font-size: 11px;
            color: #94a3b8;
        }

        /* === MODALS === */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(14, 26, 47, 0.4);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-body {
            background: white;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: 24px;
            padding: 50px;
            position: relative;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .close-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-light);
            transition: color 0.3s;
        }

        .close-btn:hover {
            color: var(--primary);
        }

        /* === INVOICE SPECIFIC === */
        .invoice-container {
            font-size: 14px;
            color: #1e293b;
        }

        .invoice-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
            border-bottom: 2px solid #f1f5f9;
            padding-bottom: 30px;
        }

        .hotel-brand h2 {
            font-family: 'Playfair Display', serif;
            color: var(--primary);
            font-size: 28px;
            margin-bottom: 5px;
        }

        .hotel-brand p {
            color: var(--text-light);
            font-size: 13px;
        }

        .invoice-meta {
            text-align: right;
        }

        .invoice-meta h1 {
            font-size: 32px;
            color: #e2e8f0;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .bill-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 40px;
        }

        .bill-to h3,
        .bill-from h3 {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-light);
            margin-bottom: 12px;
        }

        .invoice-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }

        .invoice-table th {
            text-align: left;
            padding: 15px;
            background: #f8fafc;
            color: var(--text-light);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-top: 1px solid #f1f5f9;
            border-bottom: 1px solid #f1f5f9;
        }

        .invoice-table td {
            padding: 15px;
            border-bottom: 1px solid #f1f5f9;
        }

        .total-section {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            width: 250px;
            margin-bottom: 8px;
        }

        .total-row.grand-total {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid var(--primary);
            color: var(--primary);
            font-weight: 700;
            font-size: 20px;
        }

        .paid-stamp {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            border: 4px solid #22c55e;
            color: #22c55e;
            padding: 10px 30px;
            font-size: 32px;
            font-weight: 800;
            text-transform: uppercase;
            border-radius: 12px;
            opacity: 0.15;
            pointer-events: none;
            user-select: none;
            z-index: 5;
        }

        /* === PRINT OPTIMIZATION === */
        @media print {
            body * {
                visibility: hidden;
            }

            .modal.active,
            .modal.active * {
                visibility: visible;
            }

            .modal.active {
                position: absolute;
                inset: 0;
                margin: 0;
                padding: 0;
                background: white;
                backdrop-filter: none;
                display: block !important;
            }

            .modal-body {
                box-shadow: none;
                padding: 0;
                max-width: none;
                width: 100%;
            }

            .close-btn,
            .print-actions {
                display: none !important;
            }
        }

        /* === RESPONSIVE === */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .panels-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-logo">H√¥tel</div>
        <ul class="nav-menu">
            <li class="nav-item active">üìä Vue d'ensemble</li>
            <li class="nav-item" onclick="window.location.href='index.html'">üí¨ Assistant Chat</li>
            <li class="nav-item">üíé Catalogue Premium</li>
            <li class="nav-item">üìÖ Planning</li>
            <li class="nav-item">üìà Rapports</li>
        </ul>
        <div
            style="margin-top: auto; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 12px; font-size: 12px;">
            <p style="color: var(--secondary); font-weight: bold; margin-bottom: 5px;">Club Prestige</p>
            <p style="color: #64748b;">G√©rez vos clients fid√®les et offrez des surclassements.</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header-top">
            <h1>Console de Gestion</h1>
            <div style="display: flex; gap: 15px; align-items: center;">
                <span style="font-size: 14px; color: #64748b;">Derni√®re synchro: <b id="last-sync">--:--</b></span>
                <button onclick="refreshAll()"
                    style="background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">Rafra√Æchir</button>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <p class="stat-label">Revenus (Simulation)</p>
                <p class="stat-value" id="stat-revenue">-- ‚Ç¨</p>
                <p class="stat-increase">‚Üë 12% vs mois dernier</p>
            </div>
            <div class="stat-card">
                <p class="stat-label">R√©servations</p>
                <p class="stat-value" id="stat-bookings">0</p>
                <p class="stat-increase">‚Üë 5 nouvelles aujourd'hui</p>
            </div>
            <div class="stat-card">
                <p class="stat-label">Interactions IA</p>
                <p class="stat-value" id="stat-chats">0</p>
                <p class="stat-increase" style="color: var(--secondary);">82% Taux de conversion</p>
            </div>
            <div class="stat-card">
                <p class="stat-label">Taux d'Occupation</p>
                <p class="stat-value">94%</p>
                <p class="stat-increase">Performance Optimale</p>
            </div>
        </div>

        <!-- Lists -->
        <div class="panels-grid">
            <!-- Reservations List -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">üìÖ Derni√®res R√©servations</span>
                    <span style="font-size: 13px; color: var(--text-light);" id="res-count-badge">0 R√©servations</span>
                </div>
                <div class="panel-content" id="reservations-list">
                    <div style="text-align: center; color: #94a3b8; padding: 40px;">Chargement...</div>
                </div>
            </div>

            <!-- AI Interactions List -->
            <div class="panel">
                <div class="panel-header">
                    <span class="panel-title">ü§ñ Intelligence Conversationnelle</span>
                </div>
                <div class="panel-content" id="interactions-list">
                    <!-- Dynamic -->
                </div>
            </div>

            <!-- Catalog Section -->
            <div class="panel" style="grid-column: 1 / -1; margin-top: 30px;">
                <div class="panel-header">
                    <span class="panel-title">üõçÔ∏è Catalogue de Services Premium</span>
                </div>
                <div class="panel-content" id="catalog-list"
                    style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                    <!-- Dynamic -->
                </div>
            </div>
        </div>
    </div>

    <!-- Invoice Modal -->
    <div class="modal" id="invoice-modal">
        <div class="modal-body">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div id="invoice-target"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let resData = [];

        async function refreshAll() {
            document.getElementById('last-sync').textContent = new Date().toLocaleTimeString();
            await Promise.all([loadReservations(), loadCatalog()]);
            loadInteractions();
        }

        async function loadReservations() {
            try {
                const r = await fetch(`${API_URL}/api/reservations`);
                resData = await r.json();
                renderReservations(resData);
                updateStats();
            } catch (e) { console.error(e); }
        }

        async function loadCatalog() {
            try {
                const r = await fetch(`${API_URL}/api/catalog`);
                const items = await r.json();
                renderCatalog(items);
            } catch (e) { console.error(e); }
        }

        function renderReservations(data) {
            const container = document.getElementById('reservations-list');
            document.getElementById('res-count-badge').textContent = `${data.length} R√©servations`;

            container.innerHTML = data.reverse().map((res, i) => `
                <div class="card">
                    <div class="card-row">
                        <span class="guest-name">${res.guest_name}</span>
                        <span class="card-tag status-${res.status}">${res.status.replace('_', ' ')}</span>
                    </div>
                    <p class="guest-contact">üìß ${res.email} | üìû ${res.phone}</p>
                    <div class="stay-details">
                        <span>üõèÔ∏è ${res.room_type}</span>
                        <span>üìÖ ${res.check_in} au ${res.check_out}</span>
                    </div>
                    ${res.add_ons && res.add_ons.length > 0 ? `
                    <div style="font-size: 11px; margin-top: 8px; color: #64748b;">
                        üì¶ Extras: ${res.add_ons.join(', ')}
                    </div>` : ''}
                    <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <b style="color: var(--primary);">${res.total_amount} ‚Ç¨</b>
                        <button onclick="showInvoice(${data.length - 1 - i})" style="border: 1px solid var(--primary); background: transparent; color: var(--primary); padding: 5px 12px; border-radius: 8px; font-size: 12px; cursor: pointer;">D√©tails Facture</button>
                    </div>
                </div>
            `).join('');
        }

        function renderCatalog(items) {
            const container = document.getElementById('catalog-list');
            container.innerHTML = items.map(item => `
                <div class="card" style="margin-bottom: 0;">
                    <div style="display: flex; gap: 15px;">
                        <div style="flex:1;">
                            <b style="color: var(--primary); display: block; margin-bottom: 5px;">${item.name}</b>
                            <p style="font-size: 12px; color: #64748b;">${item.description}</p>
                            <span style="display: inline-block; margin-top: 10px; color: var(--secondary); font-weight: bold;">${item.price} ‚Ç¨</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadInteractions() {
            const ints = JSON.parse(localStorage.getItem('hotel_interactions') || '[]');
            const container = document.getElementById('interactions-list');
            document.getElementById('stat-chats').textContent = ints.length;

            if (ints.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#94a3b8; padding:40px;">Aucune donn√©e IA enregistr√©e.</p>';
                return;
            }

            container.innerHTML = ints.slice(-10).reverse().map(int => `
                <div class="interaction-item">
                    <div class="intent-icon">${getIcon(int.intent)}</div>
                    <div class="int-content">
                        <p class="int-q">${int.question}</p>
                        <p class="int-a">${int.answer.substring(0, 100)}${int.answer.length > 100 ? '...' : ''}</p>
                        <p class="int-time">${formatTimeAgo(int.timestamp)}</p>
                    </div>
                </div>
            `).join('');
        }

        function getIcon(intent) {
            const map = { check_availability: 'üìÖ', make_reservation: 'üõéÔ∏è', hotel_information: '‚ÑπÔ∏è', talk_to_human: 'üë§' };
            return map[intent] || 'üí¨';
        }

        function formatTimeAgo(timestamp) {
            const seconds = Math.floor((Date.now() - timestamp) / 1000);
            if (seconds < 60) return "√Ä l'instant";
            if (seconds < 3600) return `Il y a ${Math.floor(seconds / 60)} min`;
            if (seconds < 86400) return `Il y a ${Math.floor(seconds / 3600)} h`;
            return `Il y a ${Math.floor(seconds / 86400)} j`;
        }

        function updateStats() {
            const revenue = resData.reduce((acc, current) => acc + (current.total_amount || 0), 0);
            document.getElementById('stat-revenue').textContent = `${revenue.toLocaleString()} ‚Ç¨`;
            document.getElementById('stat-bookings').textContent = resData.length;
        }

        function showInvoice(idx) {
            const res = resData[idx];
            if (!res) return;
            const modal = document.getElementById('invoice-modal');
            const target = document.getElementById('invoice-target');

            const checkIn = new Date(res.check_in);
            const checkOut = new Date(res.check_out);
            const nights = Math.max(1, Math.ceil((checkOut - checkIn) / (1000 * 60 * 60 * 24)));

            const amenityLabels = { 'breakfast': 'Petit-D√©jeuner Signature', 'parking': 'Parking S√©curis√©', 'spa': 'Acc√®s Spa & D√©tente' };
            const amenityPrices = { 'breakfast': 15, 'parking': 20, 'spa': 25 };
            const roomPrice = parseInt(res.room_type === 'family' ? 145 : (res.room_type === 'superior' ? 115 : 89));

            const invoiceId = `INV-${new Date().getFullYear()}-${String(res.id || idx).padStart(4, '0')}`;
            const issueDate = new Date().toLocaleDateString('fr-FR');

            let subtotal = roomPrice * nights;
            const amenitiesHtml = (res.add_ons || []).map(a => {
                const price = (amenityPrices[a] || 0) * nights;
                subtotal += price;
                return `
                    <tr>
                        <td>${amenityLabels[a] || a}</td>
                        <td>${nights} nuit(s)</td>
                        <td>${amenityPrices[a] || 0} ‚Ç¨</td>
                        <td style="text-align:right;">${price.toLocaleString()} ‚Ç¨</td>
                    </tr>
                `;
            }).join('');

            target.innerHTML = `
                <div class="invoice-container" style="position:relative;">
                    <div class="paid-stamp">Pay√©e & Confirm√©e</div>
                    <div class="invoice-header">
                        <div class="hotel-brand">
                            <h2>H√¥tel</h2>
                            <p>by HappyCulture</p>
                            <div style="margin-top:15px; font-size:12px; line-height:1.6;">
                                üìç 27 Avenue Thiers, 06000 Nice<br>
                                üìû +33 4 93 88 20 00<br>
                                ‚úâÔ∏è hello@hotel-soco.com
                            </div>
                        </div>
                        <div class="invoice-meta">
                            <h1 style="margin-bottom:5px;">Facture</h1>
                            <p style="font-size:16px; color:var(--primary); font-weight:600;"># ${invoiceId}</p>
                            <p style="margin-top:5px; color:var(--text-light);">Date d'√©mission: ${issueDate}</p>
                        </div>
                    </div>

                    <div class="bill-grid" style="background:#f8fafc; padding:25px; border-radius:16px; border:1px solid #f1f5f9;">
                        <div class="bill-to">
                            <h3>Client / Destinataire</h3>
                            <p style="font-size:16px; color:var(--primary);"><b>${res.guest_name}</b></p>
                            <p style="margin-top:5px;">üìß ${res.email}</p>
                            <p>üìû ${res.phone}</p>
                        </div>
                        <div class="bill-from" style="text-align:right;">
                            <h3>D√©tails du S√©jour</h3>
                            <p><b>Cat√©gorie :</b> Room ${res.room_type.charAt(0).toUpperCase() + res.room_type.slice(1)}</p>
                            <p><b>P√©riode :</b> ${res.check_in} au ${res.check_out}</p>
                            <p><b>Dur√©e :</b> ${nights} nuit(s)</p>
                        </div>
                    </div>

                    <div style="margin: 30px 0 15px 0;">
                        <h3 style="font-size:11px; text-transform:uppercase; color:var(--text-light); letter-spacing:1px;">Services & H√©bergement</h3>
                    </div>

                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th style="width:50%;">Description</th>
                                <th>Qt√©</th>
                                <th>Prix Unit.</th>
                                <th style="text-align:right;">Total HT</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><b>H√©bergement</b><br><span style="font-size:12px; color:var(--text-light);">S√©jour en chambre ${res.room_type}</span></td>
                                <td>${nights}</td>
                                <td>${roomPrice} ‚Ç¨</td>
                                <td style="text-align:right;">${(roomPrice * nights).toLocaleString()} ‚Ç¨</td>
                            </tr>
                            ${amenitiesHtml}
                        </tbody>
                    </table>

                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-top: 40px;">
                        <div style="width: 50%; font-size:12px; color:var(--text-light); line-height:1.6;">
                            <p><b>Informations de paiement :</b><br>
                            Cette facture a √©t√© r√©gl√©e par carte bancaire lors de la r√©servation en ligne. Aucun paiement suppl√©mentaire n'est requis √† la r√©ception.</p>
                        </div>
                        <div class="total-section" style="width: 40%; background: #f8fafc; padding: 20px; border-radius: 12px;">
                            <div class="total-row">
                                <span style="color:var(--text-light);">Sous-total HT</span>
                                <span>${subtotal.toLocaleString()} ‚Ç¨</span>
                            </div>
                            <div class="total-row">
                                <span style="color:var(--text-light);">TVA (10% incluse)</span>
                                <span>${(subtotal * 0.1).toFixed(2)} ‚Ç¨</span>
                            </div>
                            <div class="total-row grand-total" style="border-top: 2px solid var(--primary); margin-top:15px; padding-top:15px;">
                                <span>Montant NET</span>
                                <span>${res.total_amount.toLocaleString()} ‚Ç¨</span>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 60px; border-top: 1px solid #f1f5f9; padding-top: 30px; text-align: center;">
                        <p style="font-family: 'Playfair Display', serif; color: var(--primary); font-size: 18px; margin-bottom: 5px;">H√¥tel by HappyCulture</p>
                        <p style="font-size: 11px; color: #94a3b8;">S.A.S au capital de 100 000‚Ç¨ - RCS Nice B 123 456 789 - TVA Intracom. FR 12 345 678 901</p>
                    </div>

                    <div class="print-actions" style="margin-top: 30px; display: flex; gap: 15px;">
                        <button onclick="closeModal()" style="flex: 1; padding: 15px; background: #f1f5f9; color: #64748b; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.3s;">Fermer</button>
                        <button onclick="window.print()" style="flex: 2; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"></polyline><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
                            Imprimer la facture
                        </button>
                    </div>
                </div>
            `;
            modal.classList.add('active');
        }

        function closeModal() { document.getElementById('invoice-modal').classList.remove('active'); }

        // Close modal on outside click
        window.onclick = function (event) {
            const modal = document.getElementById('invoice-modal');
            if (event.target == modal) closeModal();
        }

        // Init
        document.addEventListener('DOMContentLoaded', refreshAll);
    </script>

</body>

</html>